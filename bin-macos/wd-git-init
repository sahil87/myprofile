#!/usr/bin/env bash
set -e

WORK_DIR=$(pwd)

# Array of repositories to clone and configure
REPOS=(
  "wd-db"
  "wd-api"
  "wd-api-auth"
  "wd-api-ai"
  "wd-portal2"
  "wd-web"
)

# Clone all repositories
for repo in "${REPOS[@]}"; do
  if [ ! -d "$repo" ]; then
    git clone "git@github.com:wvrdz/$repo"
  else
    echo "Skipping $repo (directory already exists)"
  fi
done

# Configure git remotes for each repository
for repo in "${REPOS[@]}"; do
  cd "$WORK_DIR/$repo"

  # Only rename origin to upstream if upstream doesn't already exist
  if ! git remote | grep -q "^upstream$"; then
    git remote rename origin upstream
    git remote add origin "git@github.com:sahil87/$repo"
    git fetch origin
    git branch --set-upstream-to=origin/main main
  else
    echo "Skipping git remote configuration for $repo (upstream already exists)"
  fi
done

